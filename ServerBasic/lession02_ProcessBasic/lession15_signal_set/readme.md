# 信号集
## 概念
```
◼ 许多信号相关的系统调用都需要能表示一组不同的信号，多个信号可使用一个称之为
信号集的数据结构来表示，其系统数据类型为 sigset_t。
◼ 在 PCB 中有两个非常重要的信号集。一个称之为 “阻塞信号集” ，另一个称之为
“未决信号集” 。这两个信号集都是内核使用位图机制来实现的。但操作系统不允许我
们直接对这两个信号集进行位操作。而需自定义另外一个集合，借助信号集操作函数
来对 PCB 中的这两个信号集进行修改。
◼ 信号的 “未决” 是一种状态，指的是从信号的产生到信号被处理前的这一段时间。
◼ 信号的 “阻塞” 是一个开关动作，指的是阻止信号被处理，但不是阻止信号产生。
◼ 信号的阻塞就是让系统暂时保留信号留待以后发送。由于另外有办法让系统忽略信号，
所以一般情况下信号的阻塞只是暂时的，只是为了防止信号打断敏感的操作
```
## 处理过程
```
1.用户通过键盘  Ctrl + C, 产生2号信号SIGINT (信号被创建)

2.信号产生但是没有被处理 （未决）
    - 在内核中将所有的没有被处理的信号存储在一个集合中 （未决信号集）
    - SIGINT信号状态被存储在第二个标志位上
        - 这个标志位的值为0， 说明信号不是未决状态
        - 这个标志位的值为1， 说明信号处于未决状态
    
3.这个未决状态的信号，需要被处理，处理之前需要和另一个信号集（阻塞信号集），进行比较
    - 阻塞信号集默认不阻塞任何的信号
    - 如果想要阻塞某些信号需要用户调用系统的API

4.在处理的时候和阻塞信号集中的标志位进行查询，看是不是对该信号设置阻塞了
    - 如果没有阻塞，这个信号就被处理
    - 如果阻塞了，这个信号就继续处于未决状态，直到阻塞解除，这个信号就被处理
```
## 函数
```
以下的信号集操作都是针对于自定义信号集的
◼ int sigemptyset(sigset_t *set);
    -功能：清空信号集中的数据，将信号集中的所有标志位置为0
    -参数：set 传出参数，需要清空的信号集
    -返回值：0成功，失败返回-1
◼ int sigfillset(sigset_t *set);
    -功能：将信号集中的所有标志位置为1
    -参数：set 传出参数，需要操作的信号集
    -返回值：0成功，失败返回-1
◼ int sigaddset(sigset_t *set, int signum);
    -功能：设置信号集中的某一个信号对应的标志位为1，表示阻塞这个信号
    -参数：
        -set:传出参数，需要操作的信号集
        -signum:需要设置阻塞的哪个信号
    -返回值：0成功，失败返回-1
◼ int sigdelset(sigset_t *set, int signum);
    -功能：设置信号集中的某一个信号对应的标志位为0，表示不阻塞这个信号
    -参数：
        -set:传出参数，需要操作的信号集
        -signum:需要设置不阻塞的哪个信号
    -返回值：0成功，失败返回-1
◼ int sigismember(const sigset_t *set, int signum);
    -功能：判断某个信号是否阻塞
    -参数：
        -set:传入参数，需要判断的信号集
        -signum:需要判断的信号
    -返回值：1表示signum被阻塞，0表示signum不阻塞，-1表示失败
```
![信号处理流程](%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png)
当某个信号指定操作的回调函数在执行中，如果有同样的信号发送过来，则会被阻塞。直至当前的回调函数执行完毕后，再回处理被阻塞的信号。未决信号集最多纪录一次阻塞信号，更多的信号会被丢弃。
```
◼ SIGCHLD信号产生的条件
 子进程终止时
 子进程接收到 SIGSTOP 信号停止时
 子进程处在停止态，接受到SIGCONT后唤醒时
◼ 以上三种条件都会给父进程发送 SIGCHLD 信号，父进程默认会忽略该信号
```